<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Pac-Man</title>
  <link rel="icon"
      type="image/png"
      href="./images/sprite-pacman.png">
  <link rel="stylesheet" type="text/css" href="./stylesheet.css">
</head>
<body>

<div id="pacman">
</div>

</body>

<script>

  // 0 === wall
  // 1 === dot
  // 2 === empty
  // 3 === ghost
  // 4 === power pellet
  // 5 === pacman
  let FPS = 30;
  let rightPressed = false;
  let leftPressed = false;
  let upPressed = false;
  let downPressed = false;

  document.addEventListener("keydown", keyDownHandler, false);

  function keyDownHandler(e) {
    switch (e.keyCode) {
      case 37:
        leftPressed = true;
        rightPressed = false;
        upPressed = false;
        downPressed = false;
        break;
      case 38:
        upPressed = true;
        leftPressed = false;
        rightPressed = false;
        downPressed = false;
        break;
      case 39:
        rightPressed = true;
        upPressed = false;
        leftPressed = false;
        downPressed = false;
        break;
      case 40:
        downPressed = true;
        upPressed = false;
        leftPressed = false;
        rightPressed = false;
        break;
      default:
        break;
    }
  }



  const pacman = {
    col: 9,
    row: 12
  }

  class Ghost {
    constructor(name, abbr,col, row) {
      this.name = name;
      this.abbr = abbr;
      this.col = col;
      this.row = row;
      this.dir = null;
      this.prevSpace = null;
    }
  }

  const pinky = new Ghost('pinky', 'gp', 9, 9);
  const blinky = new Ghost('blinky', 'gb', 8, 10);
  const inky = new Ghost('inky','gi', 9, 10);
  const clyde = new Ghost('clyde', 'gc', 10, 10);
  const ghosts = [pinky, blinky, inky, clyde];

  const maze = [
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [0, 4, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 4, 0],
    [0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0],
    [0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0],
    [0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0],
    [2, 2, 2, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 2, 2, 2],
    [0, 0, 0, 0, 1, 0, 1, 0, 0, 'gp', 0, 0, 1, 0, 1, 0, 0, 0, 0],
    [2, 2, 2, 2, 1, 1, 1, 0, 'gb', 'gi', 'gc', 0, 1, 1, 1, 2, 2, 2, 2],
    [0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0],
    [2, 2, 2, 0, 1, 0, 1, 1, 1, 5, 1, 1, 1, 0, 1, 0, 2, 2, 2],
    [0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0],
    [0, 4, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 4, 0],
    [0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0],
    [0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0],
    [0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
  ];


  function drawMaze() {
    console.log('drawmaze')
    movePacman();

    ghosts.forEach(ghost => {
      moveGhost(ghost);
    })

    document.getElementById('pacman').innerHTML = "";
    let innerHTMLStr = "";
    for (let row = 0; row < maze.length; row += 1) {
      for (let col = 0; col < maze[0].length; col += 1) {
        switch (maze[row][col]) {
          case 0:
            innerHTMLStr += "<div class='wall'></div>"
            break;
          case 1:
            innerHTMLStr += "<div class='dot'></div>"
            break;
          case 2:
            innerHTMLStr += "<div class='ground'></div>"
            break;
          case 'gp':
            innerHTMLStr += "<div class='pinky'></div>"
            break;
          case 'gi':
            innerHTMLStr += "<div class='inky'></div>"
            break;
          case 'gb':
            innerHTMLStr += "<div class='blinky'></div>"
            break;
          case 'gc':
            innerHTMLStr += "<div class='clyde'></div>"
            break;
          case 4:
            innerHTMLStr += "<div class='power-pellet'></div>"
            break;
          case 5:
            if (leftPressed) {
              innerHTMLStr += "<div class='pacman-left'></div>"
            } else if (downPressed) {
              innerHTMLStr += "<div class='pacman-down'></div>"
            } else if (upPressed) {
              innerHTMLStr += "<div class='pacman-up'></div>"
            } else {
              innerHTMLStr += "<div class='pacman-right'></div>"
            }
            break;
        }
      }
    }

    document.getElementById('pacman').innerHTML = innerHTMLStr;
  }

  function getRandomDirection() {
    const directions = ['LEFT', 'UP', 'DOWN', 'RIGHT'];
    return directions[Math.floor(Math.random() * 4)]
  }

  function moveGhost(ghost) {
    if (ghost.dir) {
      switch(ghost.dir) {
        case 'LEFT':
          if (maze[ghost.row][ghost.col - 1] == 5) {
            maze[ghost.row][ghost.col - 1] = 2
            maze[12][9] = 5;
            pacman.row = 12;
            pacman.col = 9;
          } else if (maze[ghost.row][ghost.col - 1] == 1 || maze[ghost.row][ghost.col - 1] == 2 ||  maze[ghost.row][ghost.col - 1] == 4)  {
              maze[ghost.row][ghost.col] = ghost.prevSpace || 2;
              ghost.prevSpace = maze[ghost.row][ghost.col - 1]
              ghost.col = ghost.col - 1;
              maze[ghost.row][ghost.col] = ghost.abbr;
          } else {
            ghost.dir = getRandomDirection()
          }
          break;
        case 'UP':
          if (maze[ghost.row - 1][ghost.col] == 5) {
            maze[ghost.row - 1][ghost.col] = 2
            maze[12][9] = 5;
            pacman.row = 12;
            pacman.col = 9;
          } else if (maze[ghost.row - 1][ghost.col] == 1 ||
              maze[ghost.row - 1][ghost.col] == 2 ||
              maze[ghost.row - 1][ghost.col] == 4 )  {
            maze[ghost.row][ghost.col] = ghost.prevSpace || 2;
            ghost.prevSpace = maze[ghost.row - 1][ghost.col]
            ghost.row = ghost.row - 1;
            maze[ghost.row][ghost.col] = ghost.abbr;
          } else {
            ghost.dir = getRandomDirection();
          }
          break;
        case 'DOWN':
          if (maze[ghost.row + 1][ghost.col] == 5) {
            maze[ghost.row + 1][ghost.col] = 2
            maze[12][9] = 5;
            pacman.row = 12;
            pacman.col = 9;
          } else if (maze[ghost.row + 1][ghost.col] == 1 ||
              maze[ghost.row + 1][ghost.col] == 2 ||
              maze[ghost.row + 1][ghost.col] == 4 )  {
              maze[ghost.row][ghost.col] = ghost.prevSpace || 2;
              ghost.prevSpace = maze[ghost.row + 1][ghost.col]
              ghost.row = ghost.row + 1;
              maze[ghost.row][ghost.col] = ghost.abbr;
          } else {
            ghost.dir = getRandomDirection();
          }
          break;
        case 'RIGHT':
          if (maze[ghost.row][ghost.col + 1] == 5) {
            maze[ghost.row][ghost.col + 1] = 2;
            maze[12][9] = 5;
            pacman.row = 12;
            pacman.col = 9;
          } else if (maze[ghost.row][ghost.col + 1] == 1 ||
              maze[ghost.row][ghost.col + 1] == 2 ||
              maze[ghost.row][ghost.col + 1] == 4)  {
              maze[ghost.row][ghost.col] = ghost.prevSpace || 2;
              ghost.prevSpace = maze[ghost.row][ghost.col + 1]
              ghost.col = ghost.col + 1;
              maze[ghost.row][ghost.col] = ghost.abbr;
          } else {
            ghost.dir = getRandomDirection();
          }
        break;
      }
    } else {
      ghost.dir = getRandomDirection();
    }
  }

  function movePacman() {

    if (leftPressed) {
      if (maze[pacman.row][pacman.col - 1] != 0) {
        maze[pacman.row][pacman.col] = 2;
        pacman.col = pacman.col - 1;
        maze[pacman.row][pacman.col] = 5;
      }
    } else if (upPressed) {
      if (maze[pacman.row - 1][pacman.col] != 0) {
        maze[pacman.row][pacman.col] = 2;
        pacman.row = pacman.row - 1;
        maze[pacman.row][pacman.col] = 5;
      }
    } else if (rightPressed) {
      if (maze[pacman.row][pacman.col + 1] != 0) {
        maze[pacman.row][pacman.col] = 2;
        pacman.col = pacman.col + 1;
        maze[pacman.row][pacman.col] = 5;
      }
    } else if (downPressed) {
      if (maze[pacman.row + 1][pacman.col] != 0) {
        maze[pacman.row][pacman.col] = 2;
        pacman.row = pacman.row + 1;
        maze[pacman.row][pacman.col] = 5;
      }
    }
  }

  drawMaze();
  // window.setInterval(() => console.log('intervalgo'), 10)
  window.setInterval(drawMaze, 200)


</script>
</html>
